(テーマ)ネットワークからデータを読みデコードする
================================================

実習内容
--------

* ネットワークから送られてくるデータをncコマンドを使ってセーブする。
* ファイルを読んでデコードするプログラムを変更し、標準入力を読んでデコードするプログラムに書き換える。書き換え後、シェルのパイプ機能を使ってネットワークから読みつつあるデータを順次デコードする。

エミュレータの起動とデータフォーマット
--------------------------------------

次のコマンドでエミュレータを起動する:

    % daqmw-tc-server -D

これでポート1234番で接続を待つようになる。

データフォーマットについてはすでに説明したとおり。

データをncコマンドを使ってセーブする
------------------------------------

TCPで送られてくるデータはLinux上でncコマンドで読むことが
できる:

    % nc 127.0.0.1 1234 > data

一定時間後(たとえば5秒後)に自動で停止させるにはtimeoutコマンドを
使うのが便利である:

    % timeout 5 nc 127.0.0.1 1234 > data

エミュレータはTCPで接続されるとすぐにデータを送るように組んである。
バイナリなのでcatコマンドで内容は表示することはできない。
xxdコマンドで16進数ダンプで表示することができる。

    % xdd data

プログラムの変更
----------------

すでにファイルを読んでデコードするプログラムを書いたのでこれを
改造してパイプでつないでネットワークからデータを読んでデコードするように
改造する。

標準入力のファイルハンドラはプログラム起動時に
すでにstdinとして使えるようになっている。

    FILE *fp;
    fp = fopen("data", "r");

となっていた部分(およびプログラム引数処理部分、fopen()エラー処理部分)を

    fp = stdin;

とすると標準入力を読むようになるのですでに書いたコードを変更する。

変更後、シェルコマンドラインで

    % nc 127.0.0.1 1234 | ./decode_program

とするとncからの出力がdecode_programに標準入力として
入力され、デコード結果が表示される。


[../../bs/read_nc_decode](../../bs/read_nc_decode/) に解答例がある。

---

[ex10](../ex10)
